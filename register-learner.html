<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register Learner &mdash; Tuto</title>

  <!-- Link to your existing CSS -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- Google Font (Inter) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Additional CSS for this page -->
  <style>
    :root {
      --input-bg: #2a2a2a;
      --input-border: #444;
      --input-focus-border: var(--accent);
      --card-bg: #1f1f1f;
    }

    /* ===== Mini-hero adjustments ===== */
    .mini-hero .hero-content {
      padding: 1rem;
    }
    .mini-hero .hero-title {
      font-size: 2.25rem;
      margin-bottom: 0.5rem;
    }
    .mini-hero .hero-subtitle {
      font-size: 1rem;
      opacity: 0.85;
      max-width: 600px;
      margin: 0 auto;
    }

    /* ===== Application Card (for Learner) ===== */
    .application-card {
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
      padding: 2.5rem 2rem;
      max-width: 600px;
      margin: 2rem auto;
      animation: fadeInUp 0.8s ease-out forwards;
    }
    .application-card h2 {
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--text-light);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .application-form .form-group {
      margin-bottom: 1.75rem;
    }
    .application-form label {
      display: block;
      font-size: 1rem;
      font-weight: 500;
      color: #c8c8c8;
      margin-bottom: 0.5rem;
    }
    .application-form input[type="text"],
    .application-form input[type="email"],
    .application-form input[type="password"],
    .application-form select {
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 0.95rem;
      border: 1px solid var(--input-border);
      border-radius: 6px;
      background-color: var(--input-bg);
      color: var(--text-light);
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .application-form input:focus,
    .application-form select:focus {
      border-color: var(--input-focus-border);
      box-shadow: 0 0 8px rgba(216, 67, 21, 0.4);
    }

    /* ===== Password toggle button ===== */
    .password-wrapper {
      position: relative;
    }
    .password-wrapper input {
      padding-right: 3rem;
    }
    .toggle-password {
      position: absolute;
      top: 50%;
      right: 1rem;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 1.1rem;
      color: #c8c8c8;
      cursor: pointer;
      transition: color 0.2s;
    }
    .toggle-password:hover {
      color: var(--accent-light);
    }

    /* ===== Google Map styling ===== */
    #map {
      width: 100%;
      height: 300px;
      border-radius: 6px;
      margin-bottom: 1rem;
    }

    /* ===== Submit Button ===== */
    .application-form button[type="submit"] {
      margin-top: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      padding: 0.85rem 1.5rem;
      border-radius: 6px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: #fff;
      border: none;
      width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .application-form button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
      background: var(--accent-light);
    }

    /* ===== Error & Success Messages ===== */
    .error-message {
      color: #ff6f61;
      font-size: 0.95rem;
      text-align: center;
      margin-top: 1rem;
    }
    .success-message {
      color: #4caf50;
      font-size: 0.95rem;
      text-align: center;
      margin-top: 1rem;
    }

    /* ===== Responsive ===== */
    @media (max-width: 600px) {
      .application-card {
        padding: 1.75rem 1rem;
        margin: 1.5rem 1rem;
      }
      #map {
        height: 250px;
      }
    }
  </style>
</head>
<body>
  <!-- ====== MINI-HERO ====== -->
  <header class="hero mini-hero">
    <div class="hero-overlay"></div>
    <div class="hero-content fade-in">
      <h1 class="hero-title">Register as a Learner</h1>
      <p class="hero-subtitle">
        Create your account and select your location for matching with tutors.
      </p>
    </div>
  </header>

  <!-- ====== REGISTRATION FORM CARD ====== -->
  <main class="features-section" style="padding-top: 2rem; padding-bottom: 3rem;">
    <div class="container">
      <div class="application-card">
        <h2>Learner Registration</h2>
        <form id="registerLearnerForm" class="application-form" novalidate>
          <!-- Full Name -->
          <div class="form-group">
            <label for="learnerFullName">Full Name</label>
            <input
              type="text"
              id="learnerFullName"
              name="fullName"
              placeholder="John Doe"
              required
            />
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="learnerEmail">Email</label>
            <input
              type="email"
              id="learnerEmail"
              name="email"
              placeholder="you@example.com"
              required
            />
          </div>

          <!-- Grade / Level -->
          <div class="form-group">
            <label for="learnerGrade">Grade / Level</label>
            <select id="learnerGrade" name="grade" required>
              <option value="" disabled selected>Choose your grade</option>
              <option value="Primary 1">Primary 1</option>
              <option value="Primary 2">Primary 2</option>
              <option value="Primary 3">Primary 3</option>
              <option value="Primary 4">Primary 4</option>
              <option value="Primary 5">Primary 5</option>
              <option value="Primary 6">Primary 6</option>
              <option value="Primary 7">Primary 7</option>
              <option value="O-Level">O-Level (Form 1‚Äì4)</option>
              <option value="A-Level">A-Level (Form 5‚Äì6)</option>
            </select>
          </div>

          <!-- Password -->
          <div class="form-group">
            <label for="learnerPassword">Password</label>
            <div class="password-wrapper">
              <input
                type="password"
                id="learnerPassword"
                name="password"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                minlength="6"
                required
              />
              <button
                type="button"
                class="toggle-password"
                aria-label="Show or hide password"
              >
                üëÅÔ∏è
              </button>
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="form-group">
            <label for="learnerConfirmPassword">Confirm Password</label>
            <div class="password-wrapper">
              <input
                type="password"
                id="learnerConfirmPassword"
                name="confirmPassword"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                minlength="6"
                required
              />
              <button
                type="button"
                class="toggle-password"
                aria-label="Show or hide password"
              >
                üëÅÔ∏è
              </button>
            </div>
          </div>

          <!-- Google Map for Learner Location -->
          <div class="form-group">
            <label for="map">Your Location (Drag marker or click to set)</label>
            <div id="map"></div>
            <!-- Hidden inputs to store lat & lng -->
            <input type="hidden" id="learnerLat" name="latitude" />
            <input type="hidden" id="learnerLng" name="longitude" />
          </div>

          <!-- Submit Button -->
          <button type="submit">Register</button>

          <!-- Already have account -->
          <p style="text-align: center; margin-top: 1rem; color: #ccc; font-size: 0.9rem;">
            Already have an account? 
            <a href="login-learner.html" class="auth-link">Log in here</a>
          </p>

          <!-- Error & Success Messages -->
          <p id="learnerError" class="error-message"></p>
          <p id="learnerSuccess" class="success-message"></p>
        </form>
      </div>
    </div>
  </main>

  <!-- ====== FOOTER ====== -->
  <footer class="site-footer">
    <div class="footer-content">
      <p>&copy; 2025 Tuto. All rights reserved.</p>
      <ul class="social-links">
        <li><a href="#" aria-label="Twitter">üê¶</a></li>
        <li><a href="#" aria-label="Facebook">üìò</a></li>
        <li><a href="#" aria-label="Instagram">üì∏</a></li>
      </ul>
    </div>
  </footer>

  <!-- ====== Google Maps & Form Logic ====== -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY_HERE&callback=initMap"
    async
    defer
  ></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Map & marker variables
      let map, marker;

      // Initialize map
      window.initMap = function () {
        const defaultLocation = { lat: -17.8249, lng: 31.0498 }; // Harare

        map = new google.maps.Map(document.getElementById('map'), {
          center: defaultLocation,
          zoom: 12,
          styles: [ /* Optional: dark-mode styling */ ],
        });

        // Try HTML5 geolocation
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              const userLoc = {
                lat: pos.coords.latitude,
                lng: pos.coords.longitude,
              };
              map.setCenter(userLoc);
              placeMarker(userLoc);
            },
            () => {
              placeMarker(defaultLocation);
            }
          );
        } else {
          placeMarker(defaultLocation);
        }

        // Move marker on click
        map.addListener('click', function (e) {
          placeMarker(e.latLng);
        });
      };

      // Place or move marker & update hidden fields
      function placeMarker(location) {
        if (marker) {
          marker.setPosition(location);
        } else {
          marker = new google.maps.Marker({
            position: location,
            map: map,
            draggable: true,
          });
          // Update on drag end
          marker.addListener('dragend', () => {
            const pos = marker.getPosition();
            updateLatLngInputs(pos.lat(), pos.lng());
          });
        }
        updateLatLngInputs(location.lat, location.lng);
      }

      function updateLatLngInputs(lat, lng) {
        document.getElementById('learnerLat').value = lat;
        document.getElementById('learnerLng').value = lng;
      }

      // Toggle password visibility
      document.querySelectorAll('.toggle-password').forEach((btn) => {
        btn.addEventListener('click', () => {
          const pwdInput = btn.previousElementSibling;
          if (pwdInput.getAttribute('type') === 'password') {
            pwdInput.setAttribute('type', 'text');
            btn.textContent = 'üôà';
          } else {
            pwdInput.setAttribute('type', 'password');
            btn.textContent = 'üëÅÔ∏è';
          }
        });
      });

      // Helpers for localStorage
      function getLearners() {
        return JSON.parse(localStorage.getItem('learners') || '[]');
      }
      function saveLearners(arr) {
        localStorage.setItem('learners', JSON.stringify(arr));
      }

      const form = document.getElementById('registerLearnerForm');
      const errorPara = document.getElementById('learnerError');
      const successPara = document.getElementById('learnerSuccess');

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        errorPara.textContent = '';
        successPara.textContent = '';

        // Collect form values
        const fullName = document.getElementById('learnerFullName').value.trim();
        const email = document.getElementById('learnerEmail').value.trim().toLowerCase();
        const grade = document.getElementById('learnerGrade').value;
        const password = document.getElementById('learnerPassword').value;
        const confirmPassword = document.getElementById('learnerConfirmPassword').value;
        const latitude = document.getElementById('learnerLat').value;
        const longitude = document.getElementById('learnerLng').value;

        // Basic HTML5 validity
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        // Password match
        if (password !== confirmPassword) {
          errorPara.textContent = 'Passwords do not match.';
          return;
        }

        // Check duplicate email
        const learners = getLearners();
        if (learners.some((l) => l.email === email)) {
          errorPara.textContent = 'An account with this email already exists.';
          return;
        }

        // Create new learner object
        const newLearner = {
          fullName,
          email,
          grade,
          password, // In production, hash this!
          latitude,
          longitude,
          registeredAt: new Date().toISOString(),
        };

        // Save to localStorage
        learners.push(newLearner);
        saveLearners(learners);

        // Show success & redirect
        successPara.textContent = 'Registration successful! Redirecting to login‚Ä¶';
        setTimeout(() => {
          window.location.href = 'login-learner.html?registered=1';
        }, 1500);
      });
    });
  </script>
</body>
</html>
