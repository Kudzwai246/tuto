<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Register Learner — Tuto</title>
  <link rel="stylesheet" href="css/style.css"/>
  <style>
    /* (your existing styles) */
    .hidden-iframe { display:none; }
    .success { color: #6f6; text-align:center; margin-top:1rem; }
    .error   { color: #f66; text-align:center; margin-top:1rem; }
  </style>
</head>
<body>
  <h1>Register as a Learner</h1>
  <form
    id="registerForm"
    action="https://script.google.com/macros/s/AKfycbxQv9fa-Vqw2nKl1S-Cx1Xq547jkAOX2RsHzm70txMkWU1CaY5aWIyibkDw1nfUJDU8/exec"
    method="post"
    target="hidden_iframe"
  >
    <div>
      <label>Full Name<input name="fullName" type="text" required/></label>
    </div>
    <div>
      <label>Your Email<input name="email" type="email" required/></label>
    </div>
    <div>
      <label>Guardian’s Email<input name="guardianEmail" type="email" required/></label>
    </div>
    <div>
      <label><input name="isVocational" type="checkbox"/> Vocational student</label>
    </div>
    <div>
      <label>Grade / Level
        <select name="grade" required>
          <option value="" disabled selected>Choose grade</option>
          <optgroup label="O-Level">
            <option>Form 1 &amp; 2</option>
            <option>Form 3 &amp; 4</option>
          </optgroup>
          <optgroup label="A-Level">
            <option>Arts</option><option>Commercials</option><option>Sciences</option>
          </optgroup>
        </select>
      </label>
    </div>
    <div>
      <label>Curriculum
        <select name="curriculum" required>
          <option value="" disabled selected>Choose curriculum</option>
          <option>ZIMSEC</option><option>Cambridge</option>
        </select>
      </label>
    </div>
    <div>
      <label>Password<input name="password" type="password" minlength="6" required/></label>
    </div>
    <div>
      <label>Confirm Password<input name="confirmPassword" type="password" minlength="6" required/></label>
    </div>
    <!-- Hidden location fields -->
    <input type="hidden" name="latitude" value="-17.8249"/>
    <input type="hidden" name="longitude" value="31.0498"/>

    <button type="submit">Register</button>
  </form>

  <!-- Feedback -->
  <p id="msg" class=""></p>

  <!-- Hidden iframe to catch the form response -->
  <iframe name="hidden_iframe" class="hidden-iframe"></iframe>

  <script>
    const form = document.getElementById('registerForm');
    const msg  = document.getElementById('msg');
    const iframe = document.querySelector('iframe[name="hidden_iframe"]');

    // When the iframe loads (i.e. the form response came back), read it
    iframe.onload = () => {
      let doc, text;
      try {
        doc  = iframe.contentDocument || iframe.contentWindow.document;
        text = doc.body.innerText;
        const json = JSON.parse(text);
        if (json.success) {
          msg.textContent = 'Registration successful! Check email to verify.';
          msg.className = 'success';
          form.reset();
        } else {
          msg.textContent = json.error || 'Server error';
          msg.className = 'error';
        }
      } catch (err) {
        msg.textContent = 'Unexpected response.';
        msg.className = 'error';
      }
    };

    // Disable grade/curriculum if vocational
    form.isVocational.addEventListener('change', e => {
      const disable = e.target.checked;
      form.grade.required = form.curriculum.required = !disable;
      form.grade.disabled = form.curriculum.disabled = disable;
    });

    // Prevent submission if passwords don't match
    form.addEventListener('submit', e => {
      if (form.password.value !== form.confirmPassword.value) {
        e.preventDefault();
        msg.textContent = 'Passwords do not match.';
        msg.className = 'error';
      }
    });
  </script>
</body>
</html>
