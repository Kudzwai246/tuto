<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Apply as Teacher — Tuto</title>

  <!-- common CSS -->
  <link rel="stylesheet" href="css/style.css"/>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --input-bg: #2a2a2a;
      --input-border: #444;
      --input-focus-border: var(--accent);
      --card-bg: #1f1f1f;
    }
    .mini-hero { height:35vh; min-height:200px; }
    .mini-hero .hero-content { padding:1rem; text-align:center; }
    .mini-hero .hero-title {
      font-size:2.25rem; font-weight:700;
      background:linear-gradient(90deg,var(--accent),var(--accent-light));
      -webkit-background-clip:text; color:transparent;
      margin-bottom:.5rem;
    }
    .mini-hero .hero-subtitle {
      font-size:1rem; color:var(--text-light); opacity:.85;
    }
    .application-card {
      background:var(--card-bg); border-radius:10px;
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
      padding:2.5rem; max-width:600px; margin:2rem auto;
      animation:fadeInUp .8s ease-out forwards;
    }
    .application-card h2 {
      font-size:1.75rem; font-weight:600;
      color:var(--text-light); text-align:center;
      margin-bottom:1.5rem;
    }
    .application-form .form-group { margin-bottom:1.75rem; }
    .application-form label {
      display:block; font-size:1rem; font-weight:500;
      color:#c8c8c8; margin-bottom:.5rem;
    }
    .application-form input,
    .application-form textarea {
      width:100%; padding:.75rem 1rem;
      font-size:.95rem; border:1px solid var(--input-border);
      border-radius:6px; background:var(--input-bg);
      color:var(--text-light); outline:none;
      transition:border-color .2s,box-shadow .2s;
    }
    .application-form input:focus,
    .application-form textarea:focus {
      border-color:var(--input-focus-border);
      box-shadow:0 0 8px rgba(216,67,21,.4);
    }
    .application-form textarea { resize:vertical; min-height:100px; }

    /* file input with dynamic label */
    .file-input-wrapper {
      position:relative; overflow:hidden;
      border:1px solid var(--input-border); border-radius:6px;
      background:var(--input-bg);
    }
    .file-input-wrapper input[type=file] {
      opacity:0; width:100%; height:100%; cursor:pointer;
    }
    .file-input-wrapper::before {
      content: attr(data-label);
      display:inline-block; padding:.5rem 1rem;
      background:var(--accent); color:#fff; border-radius:6px;
      font-size:.95rem; font-weight:500;
    }

    .application-form button[type=submit] {
      margin-top:.5rem; width:100%;
      padding:.85rem 1.5rem; font-size:1rem; font-weight:600;
      border:none; border-radius:6px;
      background:linear-gradient(135deg,var(--accent),var(--accent-light));
      color:#fff; transition:transform .2s,box-shadow .2s;
    }
    .application-form button[type=submit]:hover {
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(0,0,0,.5);
    }

    .error-message { color:#ff6f61; text-align:center; margin-top:1rem; }
    .success-message { color:#4caf50; text-align:center; margin-top:1rem; }

    @media (max-width:600px) {
      .application-card { padding:1.5rem; margin:1.5rem; }
    }
  </style>
</head>
<body>

  <header class="hero mini-hero">
    <div class="hero-overlay"></div>
    <div class="hero-content fade-in">
      <h1 class="hero-title">Apply as a Teacher</h1>
      <p class="hero-subtitle">Submit your application, upload docs & set location</p>
    </div>
  </header>

  <main>
    <div class="application-card">
      <h2>Teacher Application</h2>
      <form id="appForm" class="application-form" novalidate>
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input id="fullName" name="fullName" type="text" placeholder="Jane Smith" required/>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required/>
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input id="phone" name="phone" type="tel"
                 placeholder="+263771234567"
                 pattern="^\\+?[0-9]{7,15}$"
                 required/>
        </div>
        <div class="form-group">
          <label for="subjects">Subjects Taught</label>
          <input id="subjects" name="subjects" type="text"
                 placeholder="Math, English, Physics" required/>
        </div>
        <div class="form-group">
          <label for="qualification">Highest Qualification</label>
          <input id="qualification" name="qualification" type="text"
                 placeholder="B.Ed in Secondary Education" required/>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="isVoc" name="isVocational"/> I am a vocational instructor</label>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="hasEquip" name="hasEquipment"/> I have the necessary equipment</label>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="hasSpace" name="hasSmallClassSpace"/> I have space for up to 5 learners</label>
        </div>
        <div class="form-group">
          <label for="bio">Tell Us About Yourself</label>
          <textarea id="bio" name="bio" placeholder="A brief bio..." required></textarea>
        </div>
        <div class="form-group">
          <label>Upload Resume (PDF)</label>
          <div class="file-input-wrapper" data-label="Choose PDF">
            <input id="resume" name="resume" type="file" accept="application/pdf" required/>
          </div>
        </div>
        <div class="form-group">
          <label>Upload Qualification Docs (PDF)</label>
          <div class="file-input-wrapper" data-label="Choose PDF">
            <input id="docs" name="docs" type="file" accept="application/pdf" required/>
          </div>
        </div>
        <div class="form-group">
          <label for="location">Location</label>
          <div id="map" style="width:100%;height:200px;background:#333;border-radius:6px;"></div>
          <input type="hidden" id="lat" name="latitude" value="-17.8249"/>
          <input type="hidden" id="lng" name="longitude" value="31.0498"/>
        </div>
        <button type="submit">Submit Application</button>
        <p style="text-align:center;margin-top:1rem;color:#ccc;">
          Already applied? <a href="login-teacher.html" class="auth-link">Log in here</a>
        </p>
        <p id="err" class="error-message"></p>
        <p id="ok" class="success-message"></p>
      </form>
    </div>
  </main>

  <script>
    // show filename on selection
    ['resume','docs'].forEach(id => {
      const inp = document.getElementById(id);
      inp.addEventListener('change', e => {
        const file = e.target.files[0];
        const wrapper = e.target.parentElement;
        wrapper.setAttribute('data-label', file ? file.name : 'Choose PDF');
      });
    });

    document.getElementById('appForm').addEventListener('submit', async e => {
      e.preventDefault();
      const err = document.getElementById('err');
      const ok  = document.getElementById('ok');
      err.textContent = ''; ok.textContent = '';

      const form = e.target;
      if (!form.checkValidity()) { form.reportValidity(); return; }

      const toBase64 = file => new Promise((res, rej)=>{
        const r=new FileReader();
        r.onload=()=>res(r.result.split(',')[1]);
        r.onerror=()=>rej('File read error');
        r.readAsDataURL(file);
      });

      try {
        const data = {
          fullName: form.fullName.value.trim(),
          email: form.email.value.trim(),
          phone: form.phone.value.trim(),
          subjects: form.subjects.value.trim(),
          qualification: form.qualification.value.trim(),
          bio: form.bio.value.trim(),
          isVocational: form.isVoc.checked,
          hasEquipment: form.hasEquip.checked,
          hasSmallClassSpace: form.hasSpace.checked,
          latitude: form.latitude.value,
          longitude: form.longitude.value
        };
        const resumeFile = form.resume.files[0];
        const docsFile   = form.docs.files[0];
        const [r64,d64] = await Promise.all([toBase64(resumeFile),toBase64(docsFile)]);
        Object.assign(data,{
          resumeName: resumeFile.name, resumeBase64: r64,
          docsName: docsFile.name, docsBase64: d64
        });

        const resp = await fetch(
          'https://script.google.com/macros/s/AKfycbxDttj739mRi6LXE9HP8AOtmvxh4i5K4LZ7o0ihntzVLKyKnYwvbT9q9G9c63duG_7lXg/exec?mode=apply',
          { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data) }
        );
        const json = await resp.json();
        if (resp.ok && json.success) {
          ok.textContent = 'Application submitted! We’ll be in touch.';
          form.reset();
          document.querySelectorAll('.file-input-wrapper').forEach(w=>w.setAttribute('data-label','Choose PDF'));
        } else {
          throw new Error(json.error||'Submission failed');
        }
      } catch(err) {
        document.getElementById('err').textContent = err.message||err;
      }
    });
  </script>
</body>
</html>
